#!/bin/bash

SERVERS="217.218.155.155 185.20.163.4 78.157.42.101 31.24.234.37 2.189.44.44 185.20.163.2 194.60.210.66 217.218.127.127 2.188.21.130 31.24.200.4 2.185.239.138 5.145.112.39 85.185.85.6 217.219.132.88 178.22.122.100 194.36.174.1 185.53.143.3 80.191.209.105 78.157.42.100 213.176.123.5 185.55.226.26 185.161.112.38 194.225.152.10 2.188.21.130 2.188.21.131 2.188.21.132 2.189.44.44 10.202.10.10 37.156.145.21 37.156.145.229 46.224.1.42 80.191.40.41 81.91.144.116 91.245.229.1 91.99.101.12 92.119.56.162 178.22.122.100 185.47.48.26 185.51.200.2 185.51.200.10 185.51.200.50 185.55.225.25 185.55.226.26 185.97.117.187 185.113.59.253 185.161.112.33 185.161.112.34 185.187.84.15 185.231.182.126 194.225.62.80 194.225.73.141 194.225.152.12 213.176.123.5 217.218.127.127 217.218.155.155 185.105.239.2 185.105.239.3 185.118.144.130 185.128.240.10 185.208.174.4 185.208.174.5 194.36.174.161 185.187.54.24 185.213.10.174 185.192.112.15 185.192.112.16 185.234.28.25 193.151.136.5 193.151.136.6 185.47.49.34 185.210.240.10 185.210.240.11 8.8.8.8 8.8.4.4 1.1.1.1 1.0.0.1 9.9.9.9 149.112.112.112 208.67.222.222 208.67.220.220 185.228.168.9 185.228.169.9 76.76.2.0 76.76.10.0 94.140.14.14 94.140.15.15 45.90.28.0 45.90.30.0 64.6.64.6 64.6.65.6 8.26.56.26 8.20.247.20 77.88.8.8 77.88.8.1 1.1.1.2 1.0.0.2 9.9.9.11 149.112.112.11 185.228.168.168 185.228.169.168 94.140.14.15 94.140.15.16 45.90.28.10 45.90.30.10 76.76.2.1 76.76.10.1 74.82.42.42 192.71.245.208 89.233.43.71 193.138.218.74 91.239.100.100 89.233.43.90 37.235.1.174 37.235.1.177 156.154.70.1 156.154.71.1 176.103.130.130 176.103.130.131 94.130.180.225 94.130.180.226 94.130.180.227"

GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m'

TEST_DOMAIN="google.com"
OK_SERVERS=()
MAX_OK=5

# Clear existing resolv.conf
echo -n > /etc/resolv.conf

for DNS in $SERVERS; do
  if dig @"$DNS" "$TEST_DOMAIN" +time=1 +short > /dev/null 2>&1; then
    echo -e "${GREEN}[OK]${NC} $DNS"
    OK_SERVERS+=("$DNS")
  else
    echo -e "${RED}[FAIL]${NC} $DNS"
  fi

  # Stop when 5 working servers are found
  if [ "${#OK_SERVERS[@]}" -ge "$MAX_OK" ]; then
    break
  fi
done

# Write top 5 OK DNS to resolv.conf
for DNS in "${OK_SERVERS[@]}"; do
  echo "nameserver $DNS" >> /etc/resolv.conf
done

echo -e "\nâœ… Updated /etc/resolv.conf with ${#OK_SERVERS[@]} working nameservers."
